<%- 
  model_class = Prisoner
  klass = @prisoner.currently_imprisoned == false ? ' green' : ''

  page_title strip_tags(@prisoner.name + ' | ' + @prisoner.currently_imprisoned_status)

  #page_title_right link_to('View All Prisoners', prisoners_path, class: 'btn btn-default')

  @show_page_title = false
-%>

<% if user_signed_in? %>
  <div class='actions-container'>
    <%= render partial: 'shared/show_actions',
      locals: {
        object: @prisoner,
        index_path: prisoners_path,
        show_path: prisoner_path,
        edit_path: edit_prisoner_path
      }
    %>
  </div>
<% end %>

<div class="info row">
  <div class="col-md-9 left-box">
    <div class="figure"><%= image_tag(@prisoner.portrait.url(:large), class: "img-responsive") %></div>
    <div class="name h1"><%= @prisoner.name %></div>
  </div>
  <div class="col-md-3 right-box">
    <div class="total">
      <div class="days"><%= number_with_delimiter(@prisoner.total_days_in_prison) %></div>
      <div class="in-prison">total days spent in prison</div>
    </div>
    <div class="status<%= klass %>"><%= @prisoner.currently_imprisoned_status.html_safe %></div>
  </div>
</div>
<div class="arrests">
  <div class="header"><div>Arrests</div><div><div class="hor-line"></div></div></div>
    <% @prisoner.incidents.order(date_of_arrest: :desc).each_with_index do |incident, index| %>
    <div class="arrest">
      <div class="row">
        <div class="col-md-6">
          <% if incident.date_of_release.present? %>
            <label>In Prison From: </label>
            <div class="value"><%= l incident.date_of_arrest, format: :long %> - <%= l incident.date_of_release, format: :long %></div>
          <% else %>
            <label>In Prison Since: </label>
            <div class="value"><%= l incident.date_of_arrest, format: :long %></div>
          <% end %>
        </div>
        <div class="col-md-6">
          <label>Charged Under Article(s): </label>
          <div class="value pipe">
            <%= incident.articles.map{ |art| link_to art.number, article_path(art), title: art.desc, "data-toggle" => "tooltip" }.join('<i></i>').html_safe %>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <label>Imprisoned At: </label>
          <div class="value">                      
            <%=  link_to incident.prison.name, incident.prison if incident.prison %>       
          </div>
        </div>
        <div class="col-md-6">
          <label>Categories: </label>
          <div class="value">
            <%= incident.tags.map{ |tag| link_to tag.name, tag }.join('<i></i>').html_safe %>              
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <label>Arrest Description: </label>
          <div class="descr"><%= simple_format_no_tags(incident.description_of_arrest) if incident.description_of_arrest.present? %></div>
        </div>
      </div>
      <% if incident.description_of_release.present? %>
        <div class="row">
          <div class="col-md-12">
            <label>Release Description: </label>      
            <div class="descr"><%= simple_format_no_tags(incident.description_of_release) if incident.description_of_release.present? %></div>   
          </div> 
        </div>
      <% end %>
  <% end %>
  </div>
</div>